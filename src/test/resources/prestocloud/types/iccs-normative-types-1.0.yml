tosca_definitions_version: tosca_prestocloud_mapping_1_2

metadata:
  template_name: ICCS_normative_types
  template_author: ICCS
  template_version: 1.0

description: ICCS normative types definition.

imports:
  - tosca-normative-types:1.2
  - resource-descriptions:1.0

node_types:

  # Fragments
  prestocloud.nodes.fragment.faas:
   description: A TOSCA description of a FaaS fragment
   derived_from: prestocloud.nodes.fragment
   requirements:
     - execute:
        node: prestocloud.nodes.agent.faas
        capability: prestocloud.capabilities.fragmentExecution.faas
        relationship: prestocloud.relationships.executedBy.faas

  prestocloud.nodes.fragment.jppf:
   description: A TOSCA description of a JPPF fragment
   derived_from: prestocloud.nodes.fragment
   requirements:
     - execute:
        node: prestocloud.nodes.agent.jppf
        capability: prestocloud.capabilities.fragmentExecution.jppf
        relationship: prestocloud.relationships.executedBy.jppf

  prestocloud.nodes.fragment:
   description: A TOSCA description of an application fragment
   derived_from: tosca.nodes.Root
   properties:
     id:
       type: integer
       required: true
     name:
       type: string
       required: false
     onloadable:
       type: boolean
       required: false

  # Agent nodes
  prestocloud.nodes.agent.faas:
    description: A basic FaaS-agent node
    derived_from: prestocloud.nodes.agent
    properties:
      component_version:
        type: version
        required: false
    capabilities:
      load_balancer:
        type: prestocloud.capabilities.loadBalancing.faas

  prestocloud.nodes.agent.jppf:
    description: A basic JPPF-agent node
    derived_from: prestocloud.nodes.agent
    properties:
      component_version:
        type: version
        required: false
    requirements:
      - master:
         node: prestocloud.nodes.master.jppf
         capability: prestocloud.capabilities.endpoint.jppf
         relationship: prestocloud.relationships.connectsTo.jppf

  prestocloud.nodes.agent:
    description: A basic "agent" node
    derived_from: tosca.nodes.Root
    capabilities:
      execute:
        type: prestocloud.capabilities.fragmentExecution
    properties:
      component_version:
        type: version
        required: false
    requirements:
      - host:
         node: prestocloud.nodes.compute
         capability: tosca.capabilities.Container
         relationship: tosca.relationships.HostedOn

  # FaaS load balancer node
  prestocloud.nodes.loadBalancer.faas:
    description: A FaaS alike load balancer useful for horizontally scalable fragments
    derived_from: tosca.nodes.Root
    properties:
      component_version:
        type: version
        required: false
    requirements:
      - agents:
         node: prestocloud.nodes.agent.faas
         capability: prestocloud.capabilities.loadBalancing.faas
         relationship: prestocloud.relationships.balancesLoadOn.faas
         occurrences: [2, UNBOUNDED]
      - host:
         node: prestocloud.nodes.compute
         capability: tosca.capabilities.Container
         relationship: tosca.relationships.HostedOn

  # JPPF Master node
  prestocloud.nodes.master.jppf:
    description: A JPPF Master node
    derived_from: tosca.nodes.Root
    capabilities:
      jppf_endpoint:
        type: prestocloud.capabilities.endpoint.jppf
    properties:
      component_version:
        type: version
        required: false
    requirements:
      - host:
         node: prestocloud.nodes.compute
         capability: tosca.capabilities.Container
         relationship: tosca.relationships.HostedOn

capability_types:

  # FaaS load balancing capability
  prestocloud.capabilities.loadBalancing.faas:
    description: Provide the ability to be managed by a FaaS load balancer
    derived_from: tosca.capabilities.Root
    valid_source_types: [ prestocloud.nodes.agent.faas ]

  # JPPF Master endpoint capability
  prestocloud.capabilities.endpoint.jppf:
    description: Provide JPPF master endpoint
    derived_from: tosca.capabilities.Root
    properties:
      protocol:
        type: string
        required: true
        default: tcp
      port:
        type: tosca.datatypes.network.PortDef
        required: false
      secure:
        type: boolean
        required: false
        default: false
      ip_address:
        type: string
        required: false
    valid_source_types: [ prestocloud.nodes.agent.jppf ]

  # Fragment execution capabilities
  prestocloud.capabilities.fragmentExecution.faas:
    description: Capability to execute a FaaS fragment
    derived_from: prestocloud.capabilities.fragmentExecution
    properties:
    valid_source_types: [ prestocloud.nodes.fragment.faas ]

  prestocloud.capabilities.fragmentExecution.jppf:
    description: Capability to execute a JPPF fragment
    derived_from: prestocloud.capabilities.fragmentExecution
    properties:
    valid_source_types: [ prestocloud.nodes.fragment.jppf ]

  prestocloud.capabilities.fragmentExecution:
    description: Capability to execute a PrEstoCloud fragment
    derived_from: tosca.capabilities.Root
    properties:
    valid_source_types: [ prestocloud.nodes.fragment ]

relationship_types:

  # FaaS load balancing relationship
  prestocloud.relationships.balancesLoadOn.faas:
    derived_from: tosca.relationships.Root
    valid_target_types: [ prestocloud.nodes.agent.faas ]
    properties:
      agents_number:
        type: integer
        required: false

  # JPPF Master endpoint connection relationship
  prestocloud.relationships.connectsTo.jppf:
    derived_from: tosca.relationships.Root
    valid_target_types: [ prestocloud.nodes.master.jppf ]
    properties:
      credential:
        type: tosca.datatypes.Credential
        required: false

  # Fragment execution relationships
  prestocloud.relationships.executedBy.faas:
    derived_from: prestocloud.relationships.executedBy
    valid_target_types: [ prestocloud.nodes.agent.faas ]

  prestocloud.relationships.executedBy.jppf:
    derived_from: prestocloud.relationships.executedBy
    valid_target_types: [ prestocloud.nodes.agent.jppf ]

  prestocloud.relationships.executedBy:
    derived_from: tosca.relationships.Root
    valid_target_types: [ prestocloud.nodes.agent ]
